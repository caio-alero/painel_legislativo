data_apresentacao = unlist(data_apresentacao),
autor = unlist(autor),
localizacao_atual = unlist(localizacao_atual),
status = unlist(status),
resultado = unlist(resultado))
return(dados_ws)
}
tempo_inicial <- Sys.time()
2021:2021
for(ano in 2021:2021){
dados_ws <- sapl_scrap(URL = str_replace_all(string = 'https://sapl.al.ro.leg.br/materia/pesquisar-materia?page=PAGE&tipo=&ementa=&numero=&numeracao__numero_materia=&numero_protocolo=&ano=&o=&tipo_listagem=1&tipo_origem_externa=&numero_origem_externa=&ano_origem_externa=&data_origem_externa_0=&data_origem_externa_1=&local_origem_externa=&data_apresentacao_0=01%2F01%2FAAAA&data_apresentacao_1=31%2F12%2FAAAA&data_publicacao_0=&data_publicacao_1=&autoria__autor=&autoria__primeiro_autor=unknown&autoria__autor__tipo=&autoria__autor__parlamentar_set__filiacao__partido=&relatoria__parlamentar_id=&em_tramitacao=&tramitacao__unidade_tramitacao_destino=&tramitacao__status=&materiaassunto__assunto=&indexacao=',
pattern = 'AAAA', replacement = as.character(ano)))
# tratamento dos dados ----
for(i in 1: nrow(dados_ws)) {
if(grepl('PLO', as.character(dados_ws$num_projeto[i]), fixed = TRUE)) dados_ws$projeto[i] <- 'PLO'
if(grepl('PLC', as.character(dados_ws$num_projeto[i]), fixed = TRUE)) dados_ws$projeto[i] <- 'PLC'
if(grepl('PRE', as.character(dados_ws$num_projeto[i]), fixed = TRUE)) dados_ws$projeto[i] <- 'PRE'
if(grepl('PEC', as.character(dados_ws$num_projeto[i]), fixed = TRUE)) dados_ws$projeto[i] <- 'PEC'
if(grepl('VT', as.character(dados_ws$num_projeto[i]), fixed = TRUE)) dados_ws$projeto[i] <- 'VT'
if(grepl('VP', as.character(dados_ws$num_projeto[i]), fixed = TRUE)) dados_ws$projeto[i] <- 'VP'
if(grepl('IND', as.character(dados_ws$num_projeto[i]), fixed = TRUE)) dados_ws$projeto[i] <- 'IND'
if(grepl('REQ', as.character(dados_ws$num_projeto[i]), fixed = TRUE)) dados_ws$projeto[i] <- 'REQ'
if(grepl('ECM', as.character(dados_ws$num_projeto[i]), fixed = TRUE)) dados_ws$projeto[i] <- 'ECM'
if(grepl('PDL', as.character(dados_ws$num_projeto[i]), fixed = TRUE)) dados_ws$projeto[i] <- 'PDL'
if(grepl('CEDP', as.character(dados_ws$num_projeto[i]), fixed = TRUE)) dados_ws$projeto[i] <- 'CEDP'
}
dados_ws$data <- gsub(' De ', '', dados_ws$data_apresentacao) %>%
strptime(format = '%d %B %Y')
dados_ws <- dados_ws %>%
mutate(num_projeto = gsub('\\-.*', '', num_projeto),
data_apresentacao = format(lubridate::dmy(data_apresentacao), '%d/%m/%Y'),
mes_apresentacao = lubridate::month(data_apresentacao, label = TRUE, abbr = TRUE),
ano_apresentacao = as.character(substring(data_apresentacao, 7, 11)),
num_projeto = str_trim(num_projeto, side = 'right'))
saveRDS(dados_ws, file = str_replace('data/saplAAAA.rds', 'AAAA', as.character(ano)))
}
Sys.time() - tempo_inicial
shiny::runApp()
runApp()
runApp()
runApp()
# Carregando os pacotes
library(httr)
library(jsonlite)
base_url <- 'https://sapl.al.ro.leg.br/api/schema/swagger-ui/#/materia/materia_list'
res_api <- GET(base_url)
res_api
base_url <- 'https://sapl.al.ro.leg.br/api/materia/?ano=2021'
res_api <- GET(base_url)
res_api
base_url <- 'https://sapl.al.ro.leg.br/api/materia/?ano=2021'
res_api <- GET(base_url,
query = list(
from = "2020-06-20T00:00:00Z",
to = "2020-07-07T00:00:00Z"
))
res_api
base_url <- 'https://sapl.al.ro.leg.br/api/materia/?ano=2020'
res_api <- GET(base_url,
query = list(
from = "2020-06-20T00:00:00Z",
to = "2020-07-07T00:00:00Z"
))
res_api
base_url <- 'https://sapl.al.ro.leg.br/api/materia/?ano=2020'
res_api <- GET(base_url)
res_api
files <- list.files(path = 'data/', pattern = '.rds', full.names = TRUE)
sapl_data <- do.call("bind_rows", lapply(files, readRDS))
agrupamento_status <- read.table('agrupamento_status.txt', sep = '\t', header = TRUE) %>% as_tibble()
files <- list.files(path = 'data/', pattern = '.rds', full.names = TRUE)
sapl_data <- do.call("bind_rows", lapply(files, readRDS))
sapl_data %>%
count(ano_apresentacao) %>%
mutate(cond = ifelse(ano_apresentacao == year(Sys.time()), 'blue', 'grey')) %>%
group_by(cond) %>%
e_charts(x = ano_apresentacao) %>%
e_bar(n, emphasis = list(itemStyle = list(shadowBlur = 10)),
itemStyle = list(borderRadius = 5), stack = TRUE) %>%
e_tooltip(formatter = htmlwidgets::JS("
function(params)
{
return `<strong> ${params.value[0]} </strong>
<br/>
Qtd. de matérias: ${params.value[1]}`
}  ")) %>%
e_legend(show = FALSE) %>%
e_theme('myTheme') %>%
e_color(color = c('#0791b7', '#cccccc'))
sapl_data
files <- list.files(path = 'data/', pattern = '.rds', full.names = TRUE)
sapl_data <- do.call("bind_rows", lapply(files, readRDS))
sapl_data
files <- list.files(path = 'data/', pattern = '.rds', full.names = TRUE)
sapl_data <- do.call("bind_rows", lapply(files, readRDS))
sapl_data
sapl_data %>%
count(ano_apresentacao) %>%
mutate(cond = ifelse(ano_apresentacao == year(Sys.time()), 'blue', 'grey')) %>%
group_by(cond) %>%
e_charts(x = ano_apresentacao) %>%
e_bar(n, emphasis = list(itemStyle = list(shadowBlur = 10)),
itemStyle = list(borderRadius = 5), stack = TRUE) %>%
e_tooltip(formatter = htmlwidgets::JS("
function(params)
{
return `<strong> ${params.value[0]} </strong>
<br/>
Qtd. de matérias: ${params.value[1]}`
}  ")) %>%
e_legend(show = FALSE) %>%
e_theme('myTheme') %>%
e_color(color = c('#0791b7', '#cccccc'))
files <- list.files(path = 'data/', pattern = '.rds', full.names = TRUE)
sapl_data <- do.call("bind_rows", lapply(files, readRDS))
agrupamento_status <- read.table('agrupamento_status.txt', sep = '\t', header = TRUE) %>% as_tibble()
sapl_data <- inner_join(agrupamento_status, sapl_data, by = 'status')
sapl_data$Grupo <- recode_factor(as.factor(sapl_data$Grupo),
'1' = 'Proposição Aprovada',
'2' = 'Proposição Rejeitada',
'3' = 'Em tramitação',
'4' = 'Proposição Arquivada',
'NA' = 'NA')
sapl_data
sapl_data %>%
count(ano_apresentacao) %>%
mutate(cond = ifelse(ano_apresentacao == year(Sys.time()), 'blue', 'grey')) %>%
group_by(cond) %>%
e_charts(x = ano_apresentacao) %>%
e_bar(n, emphasis = list(itemStyle = list(shadowBlur = 10)),
itemStyle = list(borderRadius = 5), stack = TRUE) %>%
e_tooltip(formatter = htmlwidgets::JS("
function(params)
{
return `<strong> ${params.value[0]} </strong>
<br/>
Qtd. de matérias: ${params.value[1]}`
}  ")) %>%
e_legend(show = FALSE) %>%
e_theme('myTheme') %>%
e_color(color = c('#0791b7', '#cccccc'))
devtools::install_github('rstudio/rmarkdown')
e_theme_register('{"color":["#0791b7","#dad944","#cccccc", "#fb5057","#47c1ff","#f2b3c9"]}', name = "myTheme")
myTheme
sapl_data %>%
filter(!is.na(Grupo)) %>%
filter(projeto %nin% c('VT', 'VP', 'REQ', 'IND')) %>%
count(Grupo) %>%
mutate(prop = round(n*100/sum(n), 1)) %>%
e_charts(Grupo) %>%
e_pie(n, radius = c("50%", "70%")) %>%
e_tooltip(trigger = 'item') %>%
e_labels(FALSE)
library(flexdashboard)
library(DT)
library(echarts4r)
library(dplyr)
library(lubridate)
library(stringr)
library(Hmisc)
options(encoding = "UTF-8")
e_theme_register('{"color":["#0791b7","#dad944","#cccccc", "#fb5057","#47c1ff","#f2b3c9"]}', name = "myTheme")
files <- list.files(path = 'data/', pattern = '.rds', full.names = TRUE)
sapl_data <- do.call("bind_rows", lapply(files, readRDS))
agrupamento_status <- read.table('agrupamento_status.txt', sep = '\t', header = TRUE) %>% as_tibble()
sapl_data <- inner_join(agrupamento_status, sapl_data, by = 'status')
sapl_data$Grupo <- recode_factor(as.factor(sapl_data$Grupo),
'1' = 'Proposição Aprovada',
'2' = 'Proposição Rejeitada',
'3' = 'Em tramitação',
'4' = 'Proposição Arquivada',
'NA' = 'NA')
sapl_data %>%
filter(!is.na(Grupo)) %>%
filter(projeto %nin% c('VT', 'VP', 'REQ', 'IND'))
sapl_data %>%
filter(!is.na(Grupo)) %>%
filter(projeto %nin% c('VT', 'VP', 'REQ', 'IND')) %>% count(projeto)
sapl_data %>%
count(projeto) %>%
mutate(prop = round(n*100/sum(n), 1)) %>%
arrange(-desc(n)) %>%
e_charts(x = projeto) %>%
e_bar(serie = n,
emphasis = list(itemStyle = list(shadowBlur = 10)),
itemStyle = list(borderRadius = 5)) %>%
e_tooltip(trigger = 'axis') %>%
e_flip_coords() %>%
e_legend(show = FALSE)
library(rvest)      # web scrapping
library(dplyr)      # manipular dados
library(stringr)    # manipular os textos
library(xml2)       # ler html
library(jbkmisc)
library(tm)
#sapl_scrap <- function(URL, tipo_materia = NULL, uma_pagina = FALSE) {
sapl_scrap <- function(URL, uma_pagina = FALSE) {
# extraindo o numero total de paginas
num_total_pages <- ifelse(uma_pagina,
1,
str_replace(URL, 'page=PAGE&', '') %>%
read_html() %>%
xml_find_all('//nav/ul') %>%
xml_text() %>%
str_clean() %>%
str_match_all('[0-9]+') %>%
unlist() %>%
as.numeric() %>%
max())
# scrapping das ementas
num_projeto <- list()
data_apresentacao <- list()
localizacao_atual <- list()
autor <- list()
ementas <- list()
status <- list()
data_ultima_tram <- list()
resultado <- list()
for(i in 1:num_total_pages) {
url <- str_replace(URL, 'PAGE', as.character(i))
pagina <- read_html(url) %>% xml_root()
# numero de materia
nodes_link <- xml_find_all(pagina, '//td//a')
#num_projeto[[i]] <- xml_text(nodes_link)[str_detect(xml_text(nodes_link), tipo_materia)]
num_projeto[[i]] <- xml_text(nodes_link)[!(xml_text(nodes_link) %in% c('Texto Original', '', 'Acompanhar Matéria'))]
num_projeto[[i]] <- num_projeto[[i]][!str_detect(num_projeto[[i]], pattern = '\n')]
# textos
textos <- xml_find_all(pagina, '//td') %>%
xml_text() %>%
str_clean()
textos <- textos[textos != ' ']
textos <- textos[-1]
#-----------------------------------------------------------------------------------------------------------
#                 data de apresentacao
#-----------------------------------------------------------------------------------------------------------
data_apresentacao[[i]] <- xml_find_all(pagina, '//td/text()[6]') %>%
xml_text() %>%
str_clean() %>%
str_trim()
#-----------------------------------------------------------------------------------------------------------
#                  AUTORIA
#-----------------------------------------------------------------------------------------------------------
autores <- ifelse(str_detect(textos, 'Autor: '),
ifelse(str_detect(textos, 'Localização Atual'),
gsub('.*Autor: (.+) Localização Atual.*', '\\1', textos),
removeWords(gsub('.*Autor: (.+)', '\\1', textos), c('Texto Original',
'Acompanhar Matéria',
'Norma.*',
'Data.*',
'Audiência.*'))),
NA) %>%
stringi::stri_trim_right()
autor[[i]] <- ifelse(str_detect(autores, 'Resultado'),
gsub('Resultado.*', '\\1', autores),
autores) %>%
str_trim()
#-----------------------------------------------------------------------------------------------------------
#                  LOCALIZACAO ATUAL
#-----------------------------------------------------------------------------------------------------------
loc_atual <- ifelse(str_detect(textos, 'Localização Atual'),
gsub('.*Localização Atual: (.+) Status.*', '\\1', textos),
NA)
localizacao_atual[[i]] <- ifelse(str_detect(textos, 'Localização Atual:'), loc_atual, NA)
#-----------------------------------------------------------------------------------------------------------
#                     EMENTAS
#-----------------------------------------------------------------------------------------------------------
ementas[[i]] <- ifelse(str_detect(textos, 'Ementa'),
gsub('.*Ementa: (.+) Apresentação.*', '\\1', textos))
#-----------------------------------------------------------------------------------------------------------
#                       STATUS
#-----------------------------------------------------------------------------------------------------------
status2 <- ifelse(str_detect(textos, 'Status'),
gsub('.*Status: (.+) Data Fim Prazo.*', '\\1', textos),
NA)
status[[i]] <- ifelse(str_detect(textos, 'Status:'), status2, NA)
#-----------------------------------------------------------------------------------------------------------
#                RESULTADO
#-----------------------------------------------------------------------------------------------------------
resultados <- ifelse(str_detect(textos, 'Resultado'),
ifelse(str_detect(textos, 'Data Votação'),
gsub('.*Resultado: (.+) Data Votação.*', '\\1', textos),
gsub('.*Resultado: (.+)', '\\1', textos)
),
NA)
resultados <- ifelse(str_detect(resultados, 'Data Da Última Tramitação'),
gsub('Data Da Última Tramitação.*', '\\1', resultados),
resultados)
resultados <- ifelse(str_detect(resultados, 'Texto Original'),
gsub('Texto Original.*', '\\1', resultados),
resultados) %>% str_trim()
resultado[[i]] <- ifelse(str_detect(resultados, 'Norma Jurídica'),
gsub('Norma Jurídica.*', '\\1', resultados),
resultados) %>% str_trim()
print(i)
}
dados_ws <- tibble(num_projeto = unlist(num_projeto),
ementa = unlist(ementas),
data_apresentacao = unlist(data_apresentacao),
autor = unlist(autor),
localizacao_atual = unlist(localizacao_atual),
status = unlist(status),
resultado = unlist(resultado))
return(dados_ws)
}
tempo_inicial <- Sys.time()
for(ano in 2021:2021){
dados_ws <- sapl_scrap(URL = str_replace_all(string = 'https://sapl.al.ro.leg.br/materia/pesquisar-materia?page=PAGE&tipo=&ementa=&numero=&numeracao__numero_materia=&numero_protocolo=&ano=&o=&tipo_listagem=1&tipo_origem_externa=&numero_origem_externa=&ano_origem_externa=&data_origem_externa_0=&data_origem_externa_1=&local_origem_externa=&data_apresentacao_0=01%2F01%2FAAAA&data_apresentacao_1=31%2F12%2FAAAA&data_publicacao_0=&data_publicacao_1=&autoria__autor=&autoria__primeiro_autor=unknown&autoria__autor__tipo=&autoria__autor__parlamentar_set__filiacao__partido=&relatoria__parlamentar_id=&em_tramitacao=&tramitacao__unidade_tramitacao_destino=&tramitacao__status=&materiaassunto__assunto=&indexacao=',
pattern = 'AAAA', replacement = as.character(ano)))
# tratamento dos dados ----
for(i in 1: nrow(dados_ws)) {
if(grepl('PLO', as.character(dados_ws$num_projeto[i]), fixed = TRUE)) dados_ws$projeto[i] <- 'PLO'
if(grepl('PLC', as.character(dados_ws$num_projeto[i]), fixed = TRUE)) dados_ws$projeto[i] <- 'PLC'
if(grepl('PRE', as.character(dados_ws$num_projeto[i]), fixed = TRUE)) dados_ws$projeto[i] <- 'PRE'
if(grepl('PEC', as.character(dados_ws$num_projeto[i]), fixed = TRUE)) dados_ws$projeto[i] <- 'PEC'
if(grepl('VT', as.character(dados_ws$num_projeto[i]), fixed = TRUE)) dados_ws$projeto[i] <- 'VT'
if(grepl('VP', as.character(dados_ws$num_projeto[i]), fixed = TRUE)) dados_ws$projeto[i] <- 'VP'
if(grepl('IND', as.character(dados_ws$num_projeto[i]), fixed = TRUE)) dados_ws$projeto[i] <- 'IND'
if(grepl('REQ', as.character(dados_ws$num_projeto[i]), fixed = TRUE)) dados_ws$projeto[i] <- 'REQ'
if(grepl('ECM', as.character(dados_ws$num_projeto[i]), fixed = TRUE)) dados_ws$projeto[i] <- 'ECM'
if(grepl('PDL', as.character(dados_ws$num_projeto[i]), fixed = TRUE)) dados_ws$projeto[i] <- 'PDL'
if(grepl('CEDP', as.character(dados_ws$num_projeto[i]), fixed = TRUE)) dados_ws$projeto[i] <- 'CEDP'
}
dados_ws$data <- gsub(' De ', '', dados_ws$data_apresentacao) %>%
strptime(format = '%d %B %Y')
dados_ws <- dados_ws %>%
mutate(num_projeto = gsub('\\-.*', '', num_projeto),
data_apresentacao = format(lubridate::dmy(data_apresentacao), '%d/%m/%Y'),
mes_apresentacao = lubridate::month(data_apresentacao, label = TRUE, abbr = TRUE),
ano_apresentacao = as.character(substring(data_apresentacao, 7, 11)),
num_projeto = str_trim(num_projeto, side = 'right'))
saveRDS(dados_ws, file = str_replace('data/saplAAAA.rds', 'AAAA', as.character(ano)))
}
Sys.time() - tempo_inicial
files <- list.files(path = 'data/', pattern = '.rds', full.names = TRUE)
sapl_data <- do.call("bind_rows", lapply(files, readRDS))
agrupamento_status <- read.table('agrupamento_status.txt', sep = '\t', header = TRUE) %>% as_tibble()
sapl_data <- inner_join(agrupamento_status, sapl_data, by = 'status')
sapl_data$Grupo <- recode_factor(as.factor(sapl_data$Grupo),
'1' = 'Proposição Aprovada',
'2' = 'Proposição Rejeitada',
'3' = 'Em tramitação',
'4' = 'Proposição Arquivada',
'NA' = 'NA')
sapl_data %>%
filter(ano_apresentacao == 2021) %>%
count(mes_apresentacao) %>%
ggplot(aes(x = mes_apresentacao, y = n, label = n, fill = '')) +
geom_bar(stat = 'identity', width = 0.7) +
# geom_line(color = 'grey30', size = 1) +
# geom_point(color = 'grey30') +
# geom_label(aes(x = 2019, y = 4500, label = "Em 2021 houve\n um aumento de x%\n em relação a 2020"),
#            hjust = 0,
#            vjust = 0.5,
#            lineheight = 0.8,
#            colour = "#555555",
#            fill = "white",
#            label.size = NA,
#            family = 'Bahnschrift',
#            size = 5)  +
# geom_curve(aes(x = 2020, y = 4100, xend = 2021, yend = 3800),
#            colour = "#555555",
#            size=0.5,
#            curvature = -0.2,
#            arrow = arrow(length = unit(0.03, "npc"))) +
geom_text(vjust = -0.2, family = 'Bahnschrift', size = 5) +
scale_fill_jama() +
labs(x = '', y = '', subtitle = 'Número de matérias apresentadas') +
coord_cartesian(ylim = c(0, 600)) +
theme_classic(base_size = 16) +
theme(
legend.position = 'none',
axis.line.x = element_line(colour = "#333333", size = 1),
panel.grid.major.y = element_line(colour = 'gray'),
panel.grid.major.x = element_blank(),
panel.grid.minor.x = element_blank(),
panel.background = element_rect(fill = 'white'),
axis.title.y = element_text(angle = 0, vjust = 1, hjust = 10),
title = element_text(size = 14),
text = element_text(size = 18, family = 'Bahnschrift')
)
library(dplyr)
library(Cairo)
library(ggplot2)
library(bbplot)
library(extrafont)
library(ggsci)
library(Hmisc)
loadfonts(device = 'win')
# materias por ano
ggsave('testjpeg.jpg', width = 10, height = 6)
sapl_data %>%
filter(ano_apresentacao == 2021) %>%
count(mes_apresentacao) %>%
ggplot(aes(x = mes_apresentacao, y = n, label = n, fill = '')) +
geom_bar(stat = 'identity', width = 0.7) +
# geom_line(color = 'grey30', size = 1) +
# geom_point(color = 'grey30') +
# geom_label(aes(x = 2019, y = 4500, label = "Em 2021 houve\n um aumento de x%\n em relação a 2020"),
#            hjust = 0,
#            vjust = 0.5,
#            lineheight = 0.8,
#            colour = "#555555",
#            fill = "white",
#            label.size = NA,
#            family = 'Bahnschrift',
#            size = 5)  +
# geom_curve(aes(x = 2020, y = 4100, xend = 2021, yend = 3800),
#            colour = "#555555",
#            size=0.5,
#            curvature = -0.2,
#            arrow = arrow(length = unit(0.03, "npc"))) +
geom_text(vjust = -0.2, family = 'Bahnschrift', size = 5) +
scale_fill_jama() +
labs(x = '', y = '', subtitle = 'Número de matérias apresentadas') +
coord_cartesian(ylim = c(0, 600)) +
theme_classic(base_size = 16) +
theme(
legend.position = 'none',
axis.line.x = element_line(colour = "#333333", size = 1),
panel.grid.major.y = element_line(colour = 'gray'),
panel.grid.major.x = element_blank(),
panel.grid.minor.x = element_blank(),
panel.background = element_rect(fill = 'white'),
axis.title.y = element_text(angle = 0, vjust = 1, hjust = 10),
title = element_text(size = 14),
text = element_text(size = 18, family = 'Bahnschrift')
)
dev.off()
sapl_data %>%
filter(ano_apresentacao == 2021) %>%
count(mes_apresentacao) %>%
ggplot(aes(x = mes_apresentacao, y = n, label = n, fill = '')) +
geom_bar(stat = 'identity', width = 0.7) +
# geom_line(color = 'grey30', size = 1) +
# geom_point(color = 'grey30') +
# geom_label(aes(x = 2019, y = 4500, label = "Em 2021 houve\n um aumento de x%\n em relação a 2020"),
#            hjust = 0,
#            vjust = 0.5,
#            lineheight = 0.8,
#            colour = "#555555",
#            fill = "white",
#            label.size = NA,
#            family = 'Bahnschrift',
#            size = 5)  +
# geom_curve(aes(x = 2020, y = 4100, xend = 2021, yend = 3800),
#            colour = "#555555",
#            size=0.5,
#            curvature = -0.2,
#            arrow = arrow(length = unit(0.03, "npc"))) +
geom_text(vjust = -0.2, family = 'Bahnschrift', size = 5) +
scale_fill_jama() +
labs(x = '', y = '', subtitle = 'Número de matérias apresentadas') +
coord_cartesian(ylim = c(0, 600)) +
theme_classic(base_size = 16) +
theme(
legend.position = 'none',
axis.line.x = element_line(colour = "#333333", size = 1),
panel.grid.major.y = element_line(colour = 'gray'),
panel.grid.major.x = element_blank(),
panel.grid.minor.x = element_blank(),
panel.background = element_rect(fill = 'white'),
axis.title.y = element_text(angle = 0, vjust = 1, hjust = 10),
title = element_text(size = 14),
text = element_text(size = 18, family = 'Bahnschrift')
)
sapl_data %>%
count(ano_apresentacao)
files <- list.files(path = 'data/', pattern = '.rds', full.names = TRUE)
sapl_data <- do.call("bind_rows", lapply(files, readRDS))
sapl_data %>%
count(ano_apresentacao)
sapl_data %>%
filter(ano_apresentacao == 2021) %>%
count(ano_apresentacao)
sapl_data %>%
filter(ano_apresentacao == 2021) %>%
count(projeto)
dim(sapl_data)
files <- list.files(path = 'data/', pattern = '.rds', full.names = TRUE)
sapl_data <- do.call("bind_rows", lapply(files, readRDS))
agrupamento_status <- read.table('agrupamento_status.txt', sep = '\t', header = TRUE) %>% as_tibble()
sapl_data <- inner_join(agrupamento_status, sapl_data, by = 'status')
sapl_data
files <- list.files(path = 'data/', pattern = '.rds', full.names = TRUE)
sapl_data <- do.call("bind_rows", lapply(files, readRDS))
agrupamento_status <- read.table('agrupamento_status.txt', sep = '\t', header = TRUE) %>% as_tibble()
agrupamento_status
read.table('agrupamento_status.txt', sep = '\t', header = TRUE) %>% as_tibble()
read.table('agrupamento_status.txt', sep = '\t', header = TRUE, encoding = 'UTF-8')
agrupamento_status <- read.table('agrupamento_status.txt', sep = '\t', header = TRUE, encoding = 'UTF-8') %>% as_tibble()
sapl_data <- inner_join(agrupamento_status, sapl_data, by = 'status')
sapl_data$Grupo <- recode_factor(as.factor(sapl_data$Grupo),
'1' = 'Proposição Aprovada',
'2' = 'Proposição Rejeitada',
'3' = 'Em tramitação',
'4' = 'Proposição Arquivada',
'NA' = 'NA')
sapl_data
sapl_data %>%
filter(ano_apresentacao == 2021) %>%
count(projeto)
sapl_data %>%
filter(ano_apresentacao == 2021) %>%
count(Grupo)
sapl_data %>%
filter(ano_apresentacao == 2021) %>%
count(Grupo, projeto)
sapl_data %>%
filter(ano_apresentacao == 2021) %>%
count(Grupo, projeto) %>% View()
7150 + 4000*0.4
7150 + 4000*0.4 + 1000
